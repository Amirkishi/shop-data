<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ - Ù†Ø³Ø®Ù‡ ØªØµØ­ÛŒØ­ Ø´Ø¯Ù‡</title>
    <style>
        /* ØªÙ…Ø§Ù… Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ¨Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯ */
        /* Ù…Ù† ÙÙ‚Ø· Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø±Ø§ Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³Ù… */
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }
        
        /* ... Ø¨Ù‚ÛŒÙ‡ Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ ... */
        
        .github-section {
            background: #24292e;
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
        }
        
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .input-row input {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            border: 2px solid #444;
            border-radius: 8px;
            background: #1a1e22;
            color: white;
            font-family: monospace;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #1a73e8, #0d47a1);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #34a853, #2d8c47);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #fbbc04, #e6a000);
            color: white;
        }
        
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 20px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.5s;
            min-width: 300px;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #34a853, #2d8c47);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ea4335, #d23f31);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: #1a73e8; margin-bottom: 30px;">ğŸ› ï¸ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ - Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ GitHub</h1>
        
        <!-- Ø¨Ø®Ø´ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø³Ø§Ø¯Ù‡â€ŒØªØ± -->
        <div class="github-section">
            <h2 style="color: white; margin-bottom: 20px;">ğŸ”— ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ</h2>
            
            <div class="input-row">
                <input type="text" id="repoOwner" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ GitHub (Ù…Ø«Ø§Ù„: yourusername)" value="">
                <input type="text" id="repoName" placeholder="Ù†Ø§Ù… Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ (Ù…Ø«Ø§Ù„: shop-data)" value="shop-data">
            </div>
            
            <div class="input-row">
                <input type="password" id="githubToken" placeholder="GitHub Personal Access Token" style="flex: 2;">
                <button onclick="saveGitHubConfig()" class="btn btn-success">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
            </div>
            
            <div style="margin: 25px 0; padding: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 10px;">
                <h3 style="color: #58a6ff; margin-bottom: 15px;">ğŸ“– Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø³Ø±ÛŒØ¹:</h3>
                <ol style="line-height: 1.8; padding-right: 20px;">
                    <li>ØªÙˆÚ©Ù† GitHub Ø±Ø§ Ø§Ø² <a href="https://github.com/settings/tokens" target="_blank" style="color: #58a6ff;">Ø§ÛŒÙ†Ø¬Ø§</a> Ø¨Ø³Ø§Ø²ÛŒØ¯</li>
                    <li>Ø¯Ø³ØªØ±Ø³ÛŒ <strong>âœ… repo</strong> Ø±Ø§ Ø­ØªÙ…Ø§Ù‹ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</li>
                    <li>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ GitHub Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</li>
                    <li>Ù†Ø§Ù… Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ shop-data)</li>
                    <li>Ø±ÙˆÛŒ "Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</li>
                    <li>Ø±ÙˆÛŒ "Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ GitHub" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</li>
                </ol>
            </div>
            
            <div id="debugInfo" style="display: none; margin: 15px 0; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; font-family: monospace; font-size: 12px;"></div>
            
            <div style="display: flex; gap: 15px; margin-top: 25px;">
                <button onclick="testGitHubConnection()" class="btn btn-warning">ğŸ” ØªØ³Øª Ø§ØªØµØ§Ù„</button>
                <button onclick="syncToGitHub()" class="btn btn-primary">â˜ï¸ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ GitHub</button>
                <button onclick="loadFromGitHub()" class="btn btn-success">ğŸ“¥ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø² GitHub</button>
            </div>
            
            <div id="statusBox" style="margin-top: 20px; padding: 15px; border-radius: 8px; background: rgba(255, 255, 255, 0.1); display: none;">
                <h4 style="color: white; margin-bottom: 10px;">ğŸ“Š ÙˆØ¶Ø¹ÛŒØª:</h4>
                <pre id="statusText" style="color: #ddd; font-family: monospace; font-size: 12px; white-space: pre-wrap;"></pre>
            </div>
        </div>
        
        <!-- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª -->
        <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 15px;">
            <h3>ğŸ“ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª</h3>
            <button onclick="createTestData()" class="btn" style="background: #6c757d; color: white; margin: 10px 0;">
                Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
            </button>
            <pre id="testData" style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd; margin-top: 10px; font-size: 12px; max-height: 200px; overflow: auto;"></pre>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>

    <script>
        // ====================
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
        // ====================
        let githubConfig = {
            token: '',
            repoOwner: '',
            repoName: 'shop-data',
            branch: 'main'
        };
        
        let shopData = {
            products: [
                { id: 1, name: 'Ú©Ù…Ø¯ ØªØ³Øª', inputs: ['Ø·ÙˆÙ„', 'Ø¹Ø±Ø¶'], materials: ['MDF', 'Ø±Ù†Ú¯'] }
            ],
            prices: {
                'Ú©Ù…Ø¯ ØªØ³Øª': { 'MDF': 100000, 'Ø±Ù†Ú¯': 150000 }
            },
            lastSync: null
        };
        
        // ====================
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        // ====================
        function loadConfig() {
            try {
                const saved = localStorage.getItem('githubConfig');
                if (saved) {
                    githubConfig = JSON.parse(saved);
                    document.getElementById('repoOwner').value = githubConfig.repoOwner || '';
                    document.getElementById('repoName').value = githubConfig.repoName || 'shop-data';
                    document.getElementById('githubToken').value = githubConfig.token ? 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' : '';
                }
                
                const savedData = localStorage.getItem('shopData');
                if (savedData) {
                    shopData = JSON.parse(savedData);
                }
                
                updateTestDataDisplay();
            } catch (e) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ:', e);
            }
        }
        
        // ====================
        // Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        // ====================
        function saveGitHubConfig() {
            const owner = document.getElementById('repoOwner').value.trim();
            const repo = document.getElementById('repoName').value.trim();
            const token = document.getElementById('githubToken').value.trim();
            
            // Ø§Ú¯Ø± ØªÙˆÚ©Ù† Ù‚Ø¨Ù„Ø§Ù‹ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ùˆ Ú©Ø§Ø±Ø¨Ø± ØªØºÛŒÛŒØ± Ù†Ø¯Ø§Ø¯Ù‡
            const currentToken = githubConfig.token;
            const newToken = token === 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' ? currentToken : token;
            
            if (!owner || !repo || !newToken) {
                showNotification('Ù„Ø·ÙØ§ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            githubConfig = {
                token: newToken,
                repoOwner: owner,
                repoName: repo,
                branch: 'main'
            };
            
            localStorage.setItem('githubConfig', JSON.stringify(githubConfig));
            document.getElementById('githubToken').value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
            
            showNotification('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
            
            // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯ÛŒØ¨Ø§Ú¯
            showDebugInfo();
        }
        
        // ====================
        // ØªØ³Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ GitHub
        // ====================
        async function testGitHubConnection() {
            if (!validateConfig()) return;
            
            const statusBox = document.getElementById('statusBox');
            const statusText = document.getElementById('statusText');
            
            statusBox.style.display = 'block';
            statusText.innerHTML = 'ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ GitHub...\n';
            
            try {
                // ØªØ³Øª Û±: Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø± ØªÙˆÚ©Ù†
                statusText.innerHTML += '\nğŸ” ØªØ³Øª Û±: Ø¨Ø±Ø±Ø³ÛŒ ØªÙˆÚ©Ù†...';
                const userResponse = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!userResponse.ok) {
                    throw new Error(`ØªÙˆÚ©Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª: ${userResponse.status}`);
                }
                
                const userData = await userResponse.json();
                statusText.innerHTML += ` âœ“\n   Ú©Ø§Ø±Ø¨Ø±: ${userData.login}\n`;
                
                // ØªØ³Øª Û²: Ø¨Ø±Ø±Ø³ÛŒ Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ
                statusText.innerHTML += '\nğŸ“ ØªØ³Øª Û²: Ø¨Ø±Ø±Ø³ÛŒ Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ...';
                const repoResponse = await fetch(
                    `https://api.github.com/repos/${githubConfig.repoOwner}/${githubConfig.repoName}`,
                    {
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                
                if (repoResponse.ok) {
                    statusText.innerHTML += ' âœ“ (Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯)\n';
                } else if (repoResponse.status === 404) {
                    statusText.innerHTML += ' âš  (Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ - Ø³Ø§Ø®ØªÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯)\n';
                } else {
                    throw new Error(`Ø®Ø·Ø§ÛŒ Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ: ${repoResponse.status}`);
                }
                
                // ØªØ³Øª Û³: Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ
                statusText.innerHTML += '\nğŸ”‘ ØªØ³Øª Û³: Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§...';
                const scopes = userResponse.headers.get('x-oauth-scopes') || '';
                statusText.innerHTML += ` âœ“\n   Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§: ${scopes}\n`;
                
                if (!scopes.includes('repo')) {
                    statusText.innerHTML += ' âš  Ù‡Ø´Ø¯Ø§Ø±: Ø¯Ø³ØªØ±Ø³ÛŒ repo Ù…Ù…Ú©Ù† Ø§Ø³Øª Ú©Ø§ÙÛŒ Ù†Ø¨Ø§Ø´Ø¯\n';
                }
                
                statusText.innerHTML += '\nâœ… Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú¯Ø°Ø±Ø§Ù†Ø¯Ù‡ Ø´Ø¯Ù†Ø¯!';
                showNotification('Ø§ØªØµØ§Ù„ Ø¨Ù‡ GitHub Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯', 'success');
                
            } catch (error) {
                statusText.innerHTML += `\nâŒ Ø®Ø·Ø§: ${error.message}`;
                showNotification(`Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
                console.error('Ø®Ø·Ø§ÛŒ ØªØ³Øª:', error);
            }
        }
        
        // ====================
        // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ GitHub
        // ====================
        async function syncToGitHub() {
            if (!validateConfig()) return;
            
            const statusBox = document.getElementById('statusBox');
            const statusText = document.getElementById('statusText');
            
            statusBox.style.display = 'block';
            statusText.innerHTML = 'ğŸ”„ Ø´Ø±ÙˆØ¹ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ...\n';
            
            try {
                // 1. Ø¨Ø±Ø±Ø³ÛŒ ÛŒØ§ Ø³Ø§Ø®Øª Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ
                statusText.innerHTML += '\nğŸ“ Ø¨Ø±Ø±Ø³ÛŒ Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ...';
                let repoExists = true;
                
                try {
                    await fetch(
                        `https://api.github.com/repos/${githubConfig.repoOwner}/${githubConfig.repoName}`,
                        {
                            headers: {
                                'Authorization': `token ${githubConfig.token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );
                } catch {
                    repoExists = false;
                }
                
                if (!repoExists) {
                    statusText.innerHTML += '\n   Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª...';
                    
                    // Ø³Ø§Ø®Øª Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ Ø¬Ø¯ÛŒØ¯
                    const createRepoResponse = await fetch('https://api.github.com/user/repos', {
                        method: 'POST',
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: githubConfig.repoName,
                            description: 'Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ±ÙˆØ´Ú¯Ø§Ù‡',
                            private: false,
                            auto_init: true
                        })
                    });
                    
                    if (!createRepoResponse.ok) {
                        throw new Error('Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ Ø³Ø§Ø®Øª. Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§ÙÛŒ Ù†Ø¨Ø§Ø´Ø¯.');
                    }
                    
                    statusText.innerHTML += ' âœ“\n';
                } else {
                    statusText.innerHTML += ' âœ“\n';
                }
                
                // 2. Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                shopData.lastSync = new Date().toISOString();
                localStorage.setItem('shopData', JSON.stringify(shopData));
                
                const content = {
                    products: shopData.products,
                    prices: shopData.prices,
                    lastSync: shopData.lastSync,
                    version: '2.0'
                };
                
                const contentBase64 = btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2))));
                
                // 3. Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ÙØ§ÛŒÙ„
                statusText.innerHTML += '\nğŸ“„ Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„ Ù…ÙˆØ¬ÙˆØ¯...';
                let sha = null;
                
                try {
                    const fileCheck = await fetch(
                        `https://api.github.com/repos/${githubConfig.repoOwner}/${githubConfig.repoName}/contents/shop-data.json`,
                        {
                            headers: {
                                'Authorization': `token ${githubConfig.token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );
                    
                    if (fileCheck.ok) {
                        const fileInfo = await fileCheck.json();
                        sha = fileInfo.sha;
                        statusText.innerHTML += ' âœ“ (ÙØ§ÛŒÙ„ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª)\n';
                    }
                } catch {
                    statusText.innerHTML += ' âœ“ (ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯)\n';
                }
                
                // 4. Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„
                statusText.innerHTML += '\nâ¬† Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§...';
                
                const uploadResponse = await fetch(
                    `https://api.github.com/repos/${githubConfig.repoOwner}/${githubConfig.repoName}/contents/shop-data.json`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ - ${new Date().toLocaleString('fa-IR')}`,
                            content: contentBase64,
                            sha: sha,
                            branch: githubConfig.branch
                        })
                    }
                );
                
                if (!uploadResponse.ok) {
                    const errorData = await uploadResponse.json();
                    throw new Error(errorData.message || `Ø®Ø·Ø§ÛŒ ${uploadResponse.status}`);
                }
                
                const result = await uploadResponse.json();
                
                statusText.innerHTML += ' âœ“\n';
                statusText.innerHTML += '\nâœ… Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!\n';
                statusText.innerHTML += `ğŸ”— ÙØ§ÛŒÙ„: ${result.content.html_url}\n`;
                statusText.innerHTML += `ğŸ• ØªØ§Ø±ÛŒØ®: ${new Date().toLocaleString('fa-IR')}`;
                
                showNotification('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø± GitHub Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯', 'success');
                updateTestDataDisplay();
                
            } catch (error) {
                statusText.innerHTML += `\nâŒ Ø®Ø·Ø§: ${error.message}`;
                showNotification(`Ø®Ø·Ø§ Ø¯Ø± Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ: ${error.message}`, 'error');
                console.error('Ø®Ø·Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ:', error);
                
                // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯
                showDebugInfo();
            }
        }
        
        // ====================
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø² GitHub
        // ====================
        async function loadFromGitHub() {
            if (!validateConfig()) return;
            
            const statusBox = document.getElementById('statusBox');
            const statusText = document.getElementById('statusText');
            
            statusBox.style.display = 'block';
            statusText.innerHTML = 'ğŸ“¥ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø² GitHub...\n';
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${githubConfig.repoOwner}/${githubConfig.repoName}/contents/shop-data.json`,
                    {
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('ÙØ§ÛŒÙ„ shop-data.json ÛŒØ§ÙØª Ù†Ø´Ø¯. Ø§Ø¨ØªØ¯Ø§ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ú©Ù†ÛŒØ¯.');
                    }
                    throw new Error(`Ø®Ø·Ø§ÛŒ ${response.status}`);
                }
                
                const fileData = await response.json();
                const decodedContent = decodeURIComponent(escape(atob(fileData.content)));
                const loadedData = JSON.parse(decodedContent);
                
                // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                if (!loadedData.products || !loadedData.prices) {
                    throw new Error('ÙØ±Ù…Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                }
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                shopData = loadedData;
                localStorage.setItem('shopData', JSON.stringify(shopData));
                
                statusText.innerHTML += 'âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù†Ø¯\n';
                statusText.innerHTML += `ğŸ• Ø¢Ø®Ø±ÛŒÙ† Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ: ${new Date(shopData.lastSync).toLocaleString('fa-IR')}\n`;
                statusText.innerHTML += `ğŸ“Š ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª: ${shopData.products.length}`;
                
                showNotification('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² GitHub Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù†Ø¯', 'success');
                updateTestDataDisplay();
                
            } catch (error) {
                statusText.innerHTML += `\nâŒ Ø®Ø·Ø§: ${error.message}`;
                showNotification(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ: ${error.message}`, 'error');
            }
        }
        
        // ====================
        // ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ
        // ====================
        function validateConfig() {
            if (!githubConfig.token || !githubConfig.repoOwner || !githubConfig.repoName) {
                showNotification('Ù„Ø·ÙØ§ Ø§Ø¨ØªØ¯Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª GitHub Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ù†ÛŒØ¯', 'error');
                return false;
            }
            return true;
        }
        
        function showDebugInfo() {
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.style.display = 'block';
            debugDiv.innerHTML = `
                <strong>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯ÛŒØ¨Ø§Ú¯:</strong><br>
                Ú©Ø§Ø±Ø¨Ø±ÛŒ: ${githubConfig.repoOwner}<br>
                Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ: ${githubConfig.repoName}<br>
                ØªÙˆÚ©Ù†: ${githubConfig.token ? 'âœ“ Ù…ÙˆØ¬ÙˆØ¯' : 'âœ— Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯'}<br>
                URL API: https://api.github.com/repos/${githubConfig.repoOwner}/${githubConfig.repoName}/contents/shop-data.json
            `;
        }
        
        function createTestData() {
            shopData = {
                products: [
                    { id: 1, name: 'Ú©Ù…Ø¯', inputs: ['Ø·ÙˆÙ„', 'Ø¹Ø±Ø¶'], materials: ['MDF', 'Ù…Ù„Ø§Ù…ÛŒÙ†Ù‡', 'Ø±Ù†Ú¯'] },
                    { id: 2, name: 'Ù…ÛŒØ² ØªØ­Ø±ÛŒØ±', inputs: ['Ø·ÙˆÙ„', 'Ø¹Ø±Ø¶'], materials: ['MDF', 'Ø±Ù†Ú¯'] },
                    { id: 3, name: 'Ø¯Ø±Ø§ÙˆØ±', inputs: ['ØªØ¹Ø¯Ø§Ø¯ Ú©Ø´Ùˆ'], materials: ['MDF', 'Ù…Ù„Ø§Ù…ÛŒÙ†Ù‡'] }
                ],
                prices: {
                    'Ú©Ù…Ø¯': { 'MDF': 150000, 'Ù…Ù„Ø§Ù…ÛŒÙ†Ù‡': 180000, 'Ø±Ù†Ú¯': 220000 },
                    'Ù…ÛŒØ² ØªØ­Ø±ÛŒØ±': { 'MDF': 130000, 'Ø±Ù†Ú¯': 200000 },
                    'Ø¯Ø±Ø§ÙˆØ±': { 'MDF': 100000, 'Ù…Ù„Ø§Ù…ÛŒÙ†Ù‡': 130000 }
                },
                lastSync: new Date().toISOString()
            };
            
            localStorage.setItem('shopData', JSON.stringify(shopData));
            updateTestDataDisplay();
            showNotification('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù†Ø¯', 'success');
        }
        
        function updateTestDataDisplay() {
            document.getElementById('testData').textContent = 
                JSON.stringify(shopData, null, 2);
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
        
        // ====================
        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ
        // ====================
        document.addEventListener('DOMContentLoaded', function() {
            loadConfig();
            
            // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡
            console.log('Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª');
            console.log('Ø¨Ø±Ø§ÛŒ ØªØ³Øª:');
            console.log('1. Ø±ÙˆÛŒ "ØªØ³Øª Ø§ØªØµØ§Ù„" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯');
            console.log('2. Ø§Ú¯Ø± ØªÙˆÚ©Ù† Ø¯Ø±Ø³Øª Ø¨ÙˆØ¯ØŒ Ø±ÙˆÛŒ "Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯');
            
            // Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
            setTimeout(() => {
                if (!githubConfig.token) {
                    showNotification('Ù„Ø·ÙØ§ Ø§Ø¨ØªØ¯Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª GitHub Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'warning');
                }
            }, 1000);
        });
    </script>
</body>
</html>